<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Palestinian Casualties Timeline (1995-2025)</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
            color: #333;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .info-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .axis {
            font-size: 12px;
        }
        
        .axis-label {
            font-size: 14px;
            font-weight: bold;
        }
        
        .bar {
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        .bar:hover {
            opacity: 0.8;
        }
        
        .major-operation {
            fill: #8b0000;
        }
        
        .regular-year {
            fill: #dc143c;
        }
        
        .low-casualties {
            fill: #ff6b6b;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 12px;
            border-radius: 6px;
            pointer-events: none;
            font-size: 13px;
            max-width: 300px;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1000;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 2px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #dc143c;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #8b0000;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .controls {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 5px;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            background: #0056b3;
        }
        
        .source-note {
            font-size: 0.8rem;
            color: #666;
            margin-top: 10px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Palestinian Casualties Timeline (2000-2025)</h1>
        <p>30-year documentation of recorded fatalities from multiple credible sources</p>
        <div class="source-note">
            Sources: Gaza Health Ministry, UN OCHA, B'Tselem, The Lancet
        </div>
    </div>
    
    <div class="controls">
        <a href="simple_treemap.html" class="btn">‚Üê Back to Incidents</a>
        <a href="../index.html" class="btn">‚Üê Back to Main Hub</a>
        <button id="toggleScale" class="btn">Toggle Log Scale</button>
    </div>
    
    <div class="chart-container">
        <div id="timeline-chart"></div>
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color major-operation"></div>
                <span>Major Military Operations (1000+ casualties)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color regular-year"></div>
                <span>Regular Years (100-999 casualties)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color low-casualties"></div>
                <span>Lower Casualty Years (<100 casualties)</span>
            </div>
        </div>
    </div>
    
    <div class="info-panel">
        <h3>Summary Statistics</h3>
        <div class="stats-grid" id="stats-grid">
            <!-- Stats will be populated by JavaScript -->
        </div>
        
        <div id="details" style="margin-top: 20px;">
            <h4>Click on any bar to see detailed information</h4>
            <p>This timeline shows the documented Palestinian casualties from 2000-2025, highlighting major military operations and periods of escalation. The data comes from multiple credible sources including the Gaza Health Ministry, UN OCHA, and B'Tselem.</p>
        </div>
        
        <div style="margin-top: 30px; padding: 20px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 8px;">
            <h4 style="color: #856404; margin-top: 0;">üìä Lancet Study: Potential Under-reporting</h4>
            <p style="color: #856404; line-height: 1.6;">
                A <strong>July 2024 Lancet study</strong> suggests that the actual death toll in Gaza could be significantly higher than reported figures. 
                The study estimates that <strong>indirect deaths could push the total to 186,000 or more</strong>, accounting for deaths from 
                disease, malnutrition, and lack of medical care caused by the destruction of healthcare infrastructure.
            </p>
            <p style="color: #856404; line-height: 1.6;">
                <strong>Source:</strong> <a href="https://www.aljazeera.com/news/2024/7/8/gaza-toll-could-exceed-186000-lancet-study-says" 
                target="_blank" style="color: #856404; text-decoration: underline;">
                Al Jazeera - "Gaza toll could exceed 186,000, Lancet study says"</a>
            </p>
        </div>
    </div>
    
    <div style="margin: 20px; padding: 20px; background: #f8d7da; border-left: 4px solid #dc3545; border-radius: 8px;">
        <h4 style="color: #721c24; margin-top: 0;">‚ö†Ô∏è IMPORTANT DISCLAIMER</h4>
        <p style="color: #721c24; line-height: 1.6; margin-bottom: 15px;">
            <strong>Educational and Documentation Purpose Only:</strong> This visualization presents documented casualty data 
            for educational awareness and historical documentation. All figures represent human lives lost and should be 
            treated with appropriate gravity and respect.
        </p>
        <p style="color: #721c24; line-height: 1.6; margin-bottom: 15px;">
            <strong>Data Sources and Verification:</strong> All data is compiled from credible sources including the Gaza Health Ministry, 
            UN Office for the Coordination of Humanitarian Affairs (OCHA), B'Tselem, and peer-reviewed studies including The Lancet. 
            Users are encouraged to independently verify information and consult original sources.
        </p>
        <p style="color: #721c24; line-height: 1.6; margin-bottom: 15px;">
            <strong>Methodology Note:</strong> Different organizations may use varying methodologies for casualty counting. 
            The Gaza Health Ministry counts identified bodies, while studies like The Lancet estimate total excess mortality 
            including indirect deaths. Both approaches provide important but different perspectives on the human cost.
        </p>
        <p style="color: #721c24; line-height: 1.6; margin-bottom: 0;">
            <strong>Ongoing Situation:</strong> As this represents an ongoing situation, casualty figures continue to evolve. 
            The most recent data should be verified with current sources. This visualization aims to provide historical context 
            and document the scale of human impact over time.
        </p>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Chart dimensions
        const margin = {top: 40, right: 40, bottom: 80, left: 80};
        const width = 1000 - margin.left - margin.right;
        const height = 500 - margin.bottom - margin.top;
        
        let isLogScale = false;
        let data = [];
        
        // Create SVG
        const svg = d3.select("#timeline-chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom);
            
        const g = svg.append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);
        
        // Tooltip
        const tooltip = d3.select("#tooltip");
        
        // Load data
        d3.json("casualties_data.json").then(function(rawData) {
            data = rawData.years;
            console.log("Data loaded:", data);
            
            calculateStats();
            drawChart();
            setupControls();
        }).catch(error => {
            console.error("Error loading data:", error);
            document.getElementById("timeline-chart").innerHTML = `
                <div style="text-align: center; padding: 50px; color: red;">
                    <h3>Error loading data</h3>
                    <p>${error.message}</p>
                </div>
            `;
        });
        
        function calculateStats() {
            const totalCasualties = d3.sum(data, d => d.casualties || 0);
            const majorOperations = data.filter(d => d.major_operation).length;
            const maxYear = d3.max(data, d => d.casualties || 0);
            const maxYearData = data.find(d => d.casualties === maxYear);
            const averageAnnual = Math.round(totalCasualties / data.length);
            
            document.getElementById("stats-grid").innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalCasualties.toLocaleString()}</div>
                    <div class="stat-label">Total Documented Casualties</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${data.length}</div>
                    <div class="stat-label">Years Documented</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${majorOperations}</div>
                    <div class="stat-label">Major Military Operations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${maxYear.toLocaleString()}</div>
                    <div class="stat-label">Highest Single Year (${maxYearData.year})</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${averageAnnual.toLocaleString()}</div>
                    <div class="stat-label">Average Annual Casualties</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">2000-2025</div>
                    <div class="stat-label">Time Period Covered</div>
                </div>
            `;
        }
        
        function drawChart() {
            // Clear previous chart
            g.selectAll("*").remove();
            
            // Scales
            const xScale = d3.scaleBand()
                .domain(data.map(d => d.year))
                .range([0, width])
                .padding(0.1);
            
            const maxValue = d3.max(data, d => d.casualties || 0);
            
            const yScale = isLogScale 
                ? d3.scaleLog()
                    .domain([1, maxValue])
                    .range([height, 0])
                : d3.scaleLinear()
                    .domain([0, maxValue])
                    .range([height, 0]);
            
            // Axes
            const xAxis = d3.axisBottom(xScale)
                .tickFormat(d => d);
            
            const yAxis = d3.axisLeft(yScale)
                .tickFormat(d => d.toLocaleString());
            
            g.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(xAxis)
                .selectAll("text")
                .style("text-anchor", "end")
                .attr("dx", "-.8em")
                .attr("dy", ".15em")
                .attr("transform", "rotate(-45)");
            
            g.append("g")
                .attr("class", "axis")
                .call(yAxis);
            
            // Axis labels
            g.append("text")
                .attr("class", "axis-label")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Casualties");
            
            g.append("text")
                .attr("class", "axis-label")
                .attr("transform", `translate(${width / 2}, ${height + margin.bottom - 10})`)
                .style("text-anchor", "middle")
                .text("Year");
            
            // Bars
            g.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", d => {
                    if (d.major_operation) return "bar major-operation";
                    if ((d.casualties || 0) >= 100) return "bar regular-year";
                    return "bar low-casualties";
                })
                .attr("x", d => xScale(d.year))
                .attr("width", xScale.bandwidth())
                .attr("y", d => yScale(Math.max(1, d.casualties || 1)))
                .attr("height", d => height - yScale(Math.max(1, d.casualties || 1)))
                .on("mouseover", function(event, d) {
                    showTooltip(event, d);
                })
                .on("mouseout", function() {
                    hideTooltip();
                })
                .on("click", function(event, d) {
                    showDetails(d);
                });
            
            // Add title
            g.append("text")
                .attr("x", width / 2)
                .attr("y", 0 - (margin.top / 2))
                .attr("text-anchor", "middle")
                .style("font-size", "16px")
                .style("font-weight", "bold")
                .text(`Palestinian Casualties by Year ${isLogScale ? '(Log Scale)' : '(Linear Scale)'}`);
        }
        
        function showTooltip(event, d) {
            tooltip.style("opacity", 1);
            
            let content = `<strong>${d.year}</strong><br>`;
            content += `<strong>Casualties:</strong> ${(d.casualties || 0).toLocaleString()}<br>`;
            
            if (d.lancet_adjusted) {
                content += `<strong>Lancet Adjusted:</strong> ${d.lancet_adjusted.toLocaleString()}<br>`;
            }
            
            if (d.lancet_total_estimate) {
                content += `<strong>Lancet Total Estimate:</strong> ${d.lancet_total_estimate.toLocaleString()}+ (including indirect deaths)<br>`;
            }
            
            content += `<strong>Source:</strong> ${d.source}<br>`;
            content += `<strong>Context:</strong> ${d.note}`;
            
            if (d.estimated_total) {
                content += `<br><strong>Estimated Total:</strong> ${d.estimated_total}`;
            }
            
            tooltip.html(content)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        }
        
        function hideTooltip() {
            tooltip.style("opacity", 0);
        }
        
        function showDetails(d) {
            let html = `<h4>${d.year} - ${(d.casualties || 0).toLocaleString()} Casualties</h4>`;
            
            html += `<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">`;
            html += `<strong>Source:</strong> ${d.source}<br>`;
            html += `<strong>Context:</strong> ${d.note}<br>`;
            
            if (d.period) {
                html += `<strong>Period:</strong> ${d.period}<br>`;
            }
            
            if (d.lancet_adjusted) {
                html += `<strong>Lancet Study Adjustment:</strong> ${d.lancet_adjusted.toLocaleString()} casualties<br>`;
                html += `<em>The Lancet study suggests significant under-reporting during this period</em><br>`;
            }
            
            if (d.lancet_total_estimate) {
                html += `<strong>Lancet Total Estimate (July 2024):</strong> ${d.lancet_total_estimate.toLocaleString()}+ casualties<br>`;
                html += `<em>Including indirect deaths from disease, malnutrition, and healthcare system collapse</em><br>`;
            }
            
            if (d.estimated_total) {
                html += `<strong>Estimated Total (including indirect):</strong> ${d.estimated_total}<br>`;
                html += `<em>${d.estimated_note}</em><br>`;
            }
            
            if (d.major_operation) {
                html += `<strong>Classification:</strong> Major Military Operation<br>`;
            }
            
            html += `</div>`;
            
            // Add historical context
            if (d.year <= 2005) {
                html += `<p><strong>Historical Context:</strong> This period was during the Second Intifada (2000-2005), characterized by widespread violence and military operations.</p>`;
            } else if (d.year >= 2023) {
                html += `<p><strong>Current Context:</strong> This represents the ongoing military campaign following October 7, 2023, with unprecedented casualty levels.</p>`;
            }
            
            document.getElementById("details").innerHTML = html;
        }
        
        function setupControls() {
            document.getElementById("toggleScale").addEventListener("click", function() {
                isLogScale = !isLogScale;
                this.textContent = isLogScale ? "Switch to Linear Scale" : "Toggle Log Scale";
                drawChart();
            });
        }
    </script>
</body>
</html>